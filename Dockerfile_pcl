FROM ros:galactic

# Install dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
  wget \
  # PCL dependencies
  libboost-dev \
  libboost-filesystem-dev \
  libboost-date-time-dev \
  libboost-iostreams-dev \
  libboost-system-dev \
  libflann-dev \
  && rm -rf /var/lib/apt/lists/*

# Build pcl
RUN wget -O pcl.tar.gz https://github.com/PointCloudLibrary/pcl/archive/refs/tags/pcl-1.12.0.tar.gz \
  && tar -xzf pcl.tar.gz \
  && rm pcl.tar.gz \
  && cmake \
    -D CMAKE_BUILD_TYPE:STRING=Release \
    -D CMAKE_INSTALL_PREFIX:STRING=/opt/pcl \
    -D BUILD_2d:BOOL=ON \
    -D BUILD_CUDA:BOOL=OFF \
    -D BUILD_GPU:BOOL=OFF \
    -D BUILD_apps:BOOL=OFF \
    -D BUILD_benchmarks:BOOL=OFF \
    -D BUILD_common:BOOL=ON \
    -D BUILD_examples:BOOL=OFF \
    -D BUILD_features:BOOL=ON \
    -D BUILD_filters:BOOL=ON \
    -D BUILD_geometry:BOOL=ON \
    -D BUILD_global_tests:BOOL=OFF \
    -D BUILD_io:BOOL=OFF \
    -D BUILD_kdtree:BOOL=ON \
    -D BUILD_keypoints:BOOL=OFF \
    -D BUILD_ml:BOOL=ON \
    -D BUILD_octree:BOOL=ON \
    -D BUILD_outofcore:BOOL=OFF \
    -D BUILD_people:BOOL=OFF \
    -D BUILD_recognition:BOOL=OFF \
    -D BUILD_registration:BOOL=OFF \
    -D BUILD_sample_consensus:BOOL=ON \
    -D BUILD_search:BOOL=ON \
    -D BUILD_segmentation:BOOL=ON \
    -D BUILD_simulation:BOOL=OFF \
    -D BUILD_stereo:BOOL=OFF \
    -D BUILD_surface:BOOL=OFF \
    -D BUILD_tools:BOOL=OFF \
    -D BUILD_tracking:BOOL=OFF \
    -D BUILD_visualization:BOOL=OFF \
    -D WITH_CUDA:BOOL=OFF \
    -D WITH_DAVIDSDK:BOOL=OFF \
    -D WITH_DOCS:BOOL=OFF \
    -D WITH_DSSDK:BOOL=OFF \
    -D WITH_ENSENSO:BOOL=OFF \
    -D WITH_LIBUSB:BOOL=OFF \
    -D WITH_OPENGL:BOOL=OFF \
    -D WITH_OPENMP:BOOL=OFF \
    -D WITH_OPENNI:BOOL=OFF \
    -D WITH_OPENNI2:BOOL=OFF \
    -D WITH_PCAP:BOOL=OFF \
    -D WITH_PNG:BOOL=OFF \
    -D WITH_QHULL:BOOL=OFF \
    -D WITH_QT:BOOL=OFF \
    -D WITH_RSSDK:BOOL=OFF \
    -D WITH_RSSDK2:BOOL=OFF \
    -D WITH_VTK:BOOL=OFF \
    -S pcl-pcl-1.12.0/ \
    -B build/ \
  && cmake --build build/ --target install \
  && rm -r pcl-pcl-1.12.0 build
